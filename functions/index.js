(()=>{"use strict";var e={n:t=>{var s=t&&t.__esModule?()=>t.default:()=>t;return e.d(s,{a:s}),s},d:(t,s)=>{for(var n in s)e.o(s,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:s[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=require("express");var s=e.n(t);const n=require("firebase-functions"),o=require("path");var r=e.n(o);const a=require("express-session");var i=e.n(a);const c=require("dotenv");var l=e.n(c);const u=require("react");var d=e.n(u);const m=require("react-dom/server"),p=require("react-router-dom"),h=require("redux"),E=require("react-redux"),b=require("firebase/app");var f=e.n(b);require("firebase/auth"),require("firebase/firestore"),require("firebase/firebase-database");const v={apiKey:"AIzaSyAQZch2fOfKBsdaWpL3KZ_kNFBS_Akn57s",authDomain:"fir-ch2-5cbdb.firebaseapp.com",databaseURL:"https://fir-ch2-5cbdb.firebaseio.com",projectId:"fir-ch2-5cbdb",storageBucket:"fir-ch2-5cbdb.appspot.com",messagingSenderId:"758456033077",appId:"1:758456033077:web:1765192f057cda6b9bb67c"},g=require("react-bootstrap"),y=require("react-router-bootstrap"),w=require("@babel/runtime/helpers/extends");var S=e.n(w);class T extends d().Component{componentDidUpdate(){const{showing:e,onDismiss:t}=this.props;e&&(clearTimeout(this.dismissTimer),this.dismissTimer=setTimeout(t,5e3))}componentWillUnmount(){clearTimeout(this.dismissTimer)}render(){const{showing:e,bsStyle:t,onDismiss:s,children:n}=this.props;return d().createElement(g.Collapse,{in:e},d().createElement("div",{style:{position:"fixed",bottom:20,left:20}},d().createElement(g.Alert,{bsStyle:t,onDismiss:s},n)))}}const x={};async function D(){const e=f().firestore();let t=[];try{(await e.collection("contacts").get()).forEach((e=>{t.push(e.data())}))}catch(e){showError("Home Snapshot error: "+e)}return t}const N=(A=function(e){var t;const{showSuccess:s,showError:n}=e,[o,r]=(0,u.useState)(x.initialData?x.initialData:null);return(0,u.useEffect)((()=>{(async()=>{try{let e=o||await D();r(e)}catch(e){n("Home useEffect fetchData error: "+e)}})()}),[]),d().createElement(d().Fragment,null,d().createElement("div",{className:"text-center"},d().createElement("h3",null,"Server-Side Rendering"),d().createElement("h3",null,o?null===(t=o[1])||void 0===t?void 0:t.name:null)))},class extends d().Component{constructor(e){super(e),this.state={toastVisible:!1,toastMessage:"",toastType:"success"},this.showSuccess=this.showSuccess.bind(this),this.showError=this.showError.bind(this),this.dismissToast=this.dismissToast.bind(this)}showSuccess(e){this.setState({toastVisible:!0,toastMessage:e,toastType:"success"})}showError(e){this.setState({toastVisible:!0,toastMessage:e,toastType:"danger"})}dismissToast(){this.setState({toastVisible:!1})}render(){const{toastType:e,toastVisible:t,toastMessage:s}=this.state;return d().createElement(d().Fragment,null,d().createElement(A,S()({showError:this.showError,showSuccess:this.showSuccess,dismissToast:this.dismissToast},this.props)),d().createElement(T,{bsStyle:e,showing:t,onDismiss:this.dismissToast},s))}});var A;N.fetchData=D;const R=N;function k(e){return"/ssr"+e}const q=[{path:k("/home"),component:R},{path:k("/about"),component:function(){return d().createElement("div",{className:"text-center"},d().createElement("h3",null,"React Server-Side Rendering Demo version 0.9"),d().createElement("h4",null,"API version 1.0"))}},{path:k("/redux-test"),component:function(){var e;const t=x.count,s=null===(e=x.session)||void 0===e?void 0:e.appVisits;let n;n="undefined"==typeof window?(0,E.useSelector)((()=>t)):(0,E.useSelector)((e=>e.count));const o=(0,E.useDispatch)();return d().createElement("div",{className:"App"},d().createElement("header",{className:"App-header"},d().createElement("h1",null,"You have visited this app ",s," ",1===s?"time":"times","."),d().createElement("h1",null,"Counter ",n),d().createElement("button",{onClick:()=>o({type:"DECREMENT"})},"-"),d().createElement("button",{onClick:()=>o({type:"INCREMENT",payload:undefined})},"+")))}},{path:k("*"),component:function(){return d().createElement("h1",null,"Page Not Found")}}];function C(){return(0,p.useLocation)(),k("/"),d().createElement(p.Switch,null,d().createElement(p.Redirect,{exact:!0,from:k("/"),to:k("/home")}),q.map((e=>d().createElement(p.Route,S()({},e,{key:e.path})))))}function L(){return d().createElement("div",null,d().createElement(I,null),d().createElement(g.Container,{fluid:!0},d().createElement(C,null)),d().createElement(_,null))}function _(){return d().createElement("small",null,d().createElement("hr",null),d().createElement("p",{className:"text-center"},"Full source code available at this"," ",d().createElement("a",{href:"https://github.com/Valentine-Efagene/MERN"},"Github repository")))}function I({user:e}){let t="";return e&&(t=d().createElement(y.LinkContainer,{to:"/ContactAdd"},d().createElement(g.NavItem,null,"Add Contact"),d().createElement(g.Container,{fluid:!0},d().createElement(C,null)))),d().createElement(g.Navbar,{bg:"light",expand:"lg"},d().createElement(g.Navbar.Toggle,{"aria-controls":"basic-navbar-nav"}),d().createElement(g.Navbar.Collapse,{id:"basic-navbar-nav"},d().createElement(g.Nav,{className:"mr-auto"},d().createElement(y.LinkContainer,{to:k("/home")},d().createElement(g.NavLink,null,"Home")),d().createElement(y.LinkContainer,{to:k("/redux-test")},d().createElement(g.NavLink,null,"Redux Test")),d().createElement(y.LinkContainer,{to:k("/about")},d().createElement(g.NavLink,null,d().createElement(g.NavItem,null,"About"))),"",t)))}k("/");const V=require("serialize-javascript");var j=e.n(V);const M=(0,h.combineReducers)({count:(e=0,t)=>{switch(t.type){case"INCREMENT":return e+(t.payload||1);case"DECREMENT":return e-(t.payload||1);default:return e}},isLogged:(e=!1,t)=>{switch(t.type){case"SIGN_IN":return!0;default:return e}},initialData:(e={},t)=>{switch(t.type){case"SET_INITIAL_DATA":return t.payload;default:return e}},userData:(e={},t)=>{switch(t.type){case"SET_USER_DATA":return t.payload;default:return e}},session:(e={},t)=>{switch(t.type){case"SET_SESSION":return t.payload;default:return e}}});l().config(),console.log("Secret: nskjdvnskj");const H=s()();H.use(s().static(r().resolve(__dirname,"dist"))),H.use(i()({secret:"keyboard cat",cookie:{maxAge:864e5}})),H.get("*",(async function(e,t){const s={};let n;const o=e.session;console.log("Session: "+o),console.log("Session App Visits: "+o.appVisits),console.log("Session id: "+o.id),o.appVisits?o.appVisits++:o.appVisits=1,console.log("Session App Visits: "+o.appVisits);const r=k(e.url),a=k(e.path),i=q.find((e=>(0,p.matchPath)(a,e)));let c=v;if(console.log("Hostname: "+e.hostname),"localhost"===e.hostname?(delete c.databaseURL,delete c.authDomain,delete c.storageBucket,console.log("Using emulator settings in server side code"),0==f().apps.length&&(f().initializeApp(c),f().auth().useEmulator("http://localhost:9099/"),f().database().useEmulator("localhost",9e3),f().firestore().useEmulator("localhost",8080))):0==f().apps.length&&f().initializeApp(c),console.log("Active route : "),console.log(i),i&&i.component.fetchData){console.log("ActiveRoute and fetchData exist");const t=(0,p.matchPath)(r,i),s=r.indexOf("?"),o=-1!==s?r.substr(s):null;try{const s=await i.component.fetchData(t,o,e.hostname);console.log("Database data from server: "),console.log(s),n=s}catch(e){console.log("Fetch Error: "+e.message)}}const l=(0,h.createStore)(M),u={count:9,isLogged:!1,initialData:n,userData:void 0,session:o};x.initialData=u.initialData,x.count=u.count,x.session=o;const b=d().createElement(E.Provider,{store:l},d().createElement(p.StaticRouter,{location:r,context:s},d().createElement(L,null))),g=(0,m.renderToString)(b);s.url?(console.log("context URL: "+s.url),t.redirect(301,s.url)):(console.log("No context URL"),t.send(function(e,t){return`\n    <html>\n      <head>\n        <meta charset="utf-8" />\n        <title>Server-side Rendering</title>\n        <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css" >\n        <meta name="viewport" content="width=device-width, initial-scale=1.0">\n      </head>\n      <body>\n        <div id="root">${e}</div>\n        <script>\n          window.__PRELOADED_STATE__ = ${j()(t)}\n        <\/script>\n        <script type="text/javascript" src="app.bundle.js"><\/script>\n        <script type="text/javascript" src="vendor.bundle.js"><\/script>\n      </body>\n    </html>\n  `}(g,u)))}));const O=H,P=s()();P.use(i()({secret:"keyboard cat",cookie:{maxAge:12e4}})),P.get("/",(function(e,t,s){e.session.views?(e.session.views++,t.setHeader("Content-Type","text/html"),t.write("<p>views: "+e.session.views+"</p>"),t.write("<p>expires in: "+e.session.cookie.maxAge/1e3+"s</p>"),t.end()):(e.session.views=1,t.end("welcome to the session demo. refresh!"))}));const U=P;exports.ssr=n.https.onRequest(O),exports.sessiontest=n.https.onRequest(U),exports.helloWorld=n.https.onRequest(((e,t)=>{n.logger.info("Hello logs!",{structuredData:!0}),t.send("Hello from Firebase!")})),exports.bigben=n.https.onRequest(((e,t)=>{const s=(new Date).getHours()%12+1;t.status(200).send(`<!doctype html>\n    <head>\n      <title>Time</title>\n    </head>\n    <body>\n      ${"BONG ".repeat(s)}\n    </body>\n  </html>`)}))})();